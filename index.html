<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Demilade's Quest üïπÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-green: #0aff00;
            --neon-red: #ff3333;
            --bg-color: #111;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Prevent selection on mobile taps */
            -webkit-user-select: none;
            touch-action: none; /* Critical for mobile game controls */
        }

        html, body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: white;
            font-family: 'Press Start 2P', cursive;
            height: 100%;
            height: 100dvh; /* Dynamic viewport height for mobile browsers */
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column; /* Vertical stack: Game Top, Controls Bottom */
        }

        /* The Game Container (CRT Effect) */
        #game-container {
            position: relative;
            flex-grow: 1; /* Takes up all remaining space */
            width: 100%;
            min-height: 0; /* Crucial for flex children to shrink properly */
            background: radial-gradient(circle, #2a2a2a 0%, #000 100%);
            overflow: hidden;
            transition: all 0.5s ease;
        }

        /* Shake Animation for Damage */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Scanline Overlay */
        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* UI Overlay */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            z-index: 20;
        }

        .hud {
            display: flex;
            justify-content: space-between;
            text-shadow: 2px 2px 0px #000;
            font-size: 12px;
        }

        .score-box { color: var(--neon-green); }
        .level-box { color: var(--neon-blue); }

        /* Start Screen & Final Screen */
        .overlay-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
            text-align: center;
            pointer-events: auto;
        }
        
        #final-screen {
            background: rgba(0,0,0,0.3); /* Transparent background for fireworks visibility */
            display: none;
            opacity: 0;
            transition: opacity 1s ease-in;
        }
        
        #final-screen.visible {
            opacity: 1;
        }

        h1 {
            color: var(--neon-pink);
            text-shadow: 4px 4px 0px var(--neon-blue);
            font-size: 2rem;
            line-height: 1.5;
            margin-bottom: 20px;
            animation: pulse 1s infinite alternate;
            padding: 0 10px;
        }

        /* Rainbow Text Animation */
        .rainbow-text {
            background: linear-gradient(
                to right, 
                #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8f00ff
            );
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: rainbow_animation 3s ease-in-out infinite;
            background-size: 400% 100%;
            filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.5));
            font-size: 2.5rem; /* Bigger for impact */
        }

        @keyframes rainbow_animation {
            0%,100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .final-msg {
            color: white;
            line-height: 2;
            margin-bottom: 30px;
            font-size: 0.9rem;
            max-width: 80%;
            text-shadow: 2px 2px 4px black;
        }

        .btn {
            background: var(--neon-blue);
            color: #000;
            border: 4px solid white;
            padding: 15px 25px;
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 0 15px var(--neon-blue);
            transition: transform 0.1s;
        }

        .btn:active { transform: scale(0.95); }

        /* Message Modal */
        #message-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: #000;
            border: 4px solid var(--neon-green);
            padding: 20px;
            width: 85%;
            max-width: 500px;
            text-align: center;
            z-index: 40;
            pointer-events: auto;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 30px rgba(10, 255, 0, 0.3);
        }

        #message-modal.active { transform: translate(-50%, -50%) scale(1); }
        
        #modal-text {
            color: white;
            line-height: 1.8;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        /* Mobile Controls - Dedicated Area */
        #mobile-controls {
            width: 100%;
            height: 200px; /* Slightly taller for comfort */
            background: #111;
            border-top: 2px solid #333;
            display: none; /* Hidden by default (desktop) */
            justify-content: center;
            align-items: center;
            grid-template-areas: 
                ". up ."
                "left . right"
                ". down .";
            gap: 15px; /* Better spacing to avoid accidental clicks */
            z-index: 25;
            pointer-events: auto;
            flex-shrink: 0;
            padding: 10px;
            padding-bottom: env(safe-area-inset-bottom, 20px);
            transition: height 0.3s ease;
        }

        .d-pad-btn {
            width: 60px; /* Bigger touch target */
            height: 60px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: var(--neon-blue);
            touch-action: none;
            user-select: none;
            cursor: pointer;
            box-shadow: 0 4px 0 #000;
            transition: all 0.05s;
        }

        .d-pad-btn.active { 
            background: rgba(255,255,255,0.3); 
            transform: translateY(4px);
            box-shadow: 0 0 0 #000;
            color: #fff;
            border-color: #fff;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            #mobile-controls { display: grid; }
            h1 { font-size: 1.5rem; }
            .hud { font-size: 10px; }
            .rainbow-text { font-size: 1.8rem; }
        }

        @keyframes pulse {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(1.05); opacity: 0.8; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="scanlines"></div>
    <canvas id="gameCanvas"></canvas>

    <!-- UI Overlay -->
    <div id="ui-layer">
        <div class="hud">
            <div class="score-box">LEVEL: <span id="scoreVal">1</span>/5</div>
            <div class="level-box">PLAYER: DEMILADE</div>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="overlay-screen">
        <h1>DEMILADE'S<br>HEART QUEST</h1>
        <p style="margin-bottom: 20px; font-size: 0.7rem; color: #aaa;">AVOID THE GLITCHES üëæ<br>COLLECT THE ITEMS</p>
        <button class="btn" onclick="startGame()">INSERT COIN / START</button>
    </div>

    <!-- Final Birthday Screen -->
    <div id="final-screen" class="overlay-screen">
        <h1 class="rainbow-text">HAPPY BIRTHDAY<br>DEMILADE!</h1>
        <div class="final-msg">
            You conquered the glitches<br>and captured my heart (again).<br><br>
            You are my greatest adventure.<br>
            <span style="color: var(--neon-pink); font-size: 1.2em; text-shadow: 0 0 10px var(--neon-pink);">I LOVE YOU! ‚ù§Ô∏è</span>
        </div>
        <button class="btn" onclick="location.reload()">PLAY AGAIN</button>
    </div>

    <!-- Message Modal -->
    <div id="message-modal">
        <h2 id="modal-title" style="color: var(--neon-pink); margin-bottom: 15px;">ITEM ACQUIRED!</h2>
        <p id="modal-text">You found a secret!</p>
        <button class="btn" onclick="closeModal()">CONTINUE</button>
    </div>
</div>

<!-- Dedicated Mobile Controls Area (Outside Game Container) -->
<div id="mobile-controls">
    <div class="d-pad-btn" style="grid-area: up;" id="btn-up">‚ñ≤</div>
    <div class="d-pad-btn" style="grid-area: left;" id="btn-left">‚óÄ</div>
    <div class="d-pad-btn" style="grid-area: right;" id="btn-right">‚ñ∂</div>
    <div class="d-pad-btn" style="grid-area: down;" id="btn-down">‚ñº</div>
</div>

<script src="script.js">
    
</script>
</body>
</html>